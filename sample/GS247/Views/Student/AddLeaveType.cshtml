@{
    ViewBag.Title = "Leave Info";
    Layout = "~/Views/Shared/_StudentLayout.cshtml";
}
    <style>
        .miniColors-trigger {
            height: 22px;
            width: 22px;
            background: url(images/trigger.png) center no-repeat;
            vertical-align: middle;
            margin: 0 .25em;
            display: inline-block;
            outline: none;
        }

        .miniColors-selector {
            position: absolute;
            width: 175px;
            height: 150px;
            background: #FFF;
            border: solid 1px #BBB;
            -moz-box-shadow: 0 0 6px rgba(0, 0, 0, .25);
            -webkit-box-shadow: 0 0 6px rgba(0, 0, 0, .25);
            box-shadow: 0 0 6px rgba(0, 0, 0, .25);
            -moz-border-radius: 5px;
            -webkit-border-radius: 5px;
            border-radius: 5px;
            padding: 5px;
            z-index: 999999;
        }

            .miniColors-selector.black {
                background: #000;
                border-color: #000;
            }

        .miniColors-colors {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 150px;
            height: 150px;
            background: url(images/gradient.png) center no-repeat;
            cursor: crosshair;
        }

        .miniColors-hues {
            position: absolute;
            top: 5px;
            left: 160px;
            width: 20px;
            height: 150px;
            background: url(images/rainbow.png) center no-repeat;
            cursor: crosshair;
        }

        .miniColors-colorPicker {
            position: absolute;
            width: 11px;
            height: 11px;
            background: url(images/circle.gif) center no-repeat;
        }

        .miniColors-huePicker {
            position: absolute;
            left: -3px;
            width: 26px;
            height: 3px;
            background: url(images/line.gif) center no-repeat;
        }
    </style>

 <div class="cont_right formWrapper">
                                    <h1>Student Leave Types</h1>

                                    <!-- Leave Types Form -->
                                    <p class="note">Fields with<span class="required">*</span> are required.</p>
                                    <div class="formCon">
                                        <div class="formConInner">
                                            <div class="form">
                                               
                                                    <input id="StudentLeaveTypeID" type="hidden" name="StudentLeaveTypeID" >
                                                    <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                                        <tr>
                                                            <td width="80"><label style="float:left" for="Name" class="required">Name <span class="required">*</span></label></td>
                                                            <td><input size="30" maxlength="255" name="Name" id="Name" type="text" required/>
                                                                <br />
                                                                <label style="display:none" id="lbl"><span class="required" id="span"></span></label></td>
                                                            <td><label style="float:left" for="Code" class="required">Code <span class="required">*</span></label></td>
                                                            <td><input size="30" maxlength="255" name="Code" id="Code" type="text" required />										<div class="errorMessage" id="StudentLeaveTypes_code_em_" style="display:none"></div></td>
                                                        </tr>
                                                        <tr>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                        </tr>
                                                        <tr>
                                                            <td><label style="float:left" for="Label" class="required">Label <span class="required">*</span></label></td>
                                                            <td><input size="30" maxlength="255" name="Label" id="Label" type="text" required />										<div class="errorMessage" id="StudentLeaveTypes_label_em_" style="display:none"></div></td>

                                                            <td><label style="float:left" for="ColorCode" class="required">Colour Code <span class="required">*</span></label></td>
                                                            <td>

                                                                <input name="ColorCode" id="ColorCode" type="text" maxlength="225" value="#000000" required />
                                                                <input type="color" id="myColor" class="ColorCode"/>                                                                
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                        </tr>
                                                        <tr>
                                                            <td><label style="" for="StatusFlag" class="required">Status <span class="required">*</span></label>										</td>
                                                            <td class="cr_align">
                                                                <select style="width:150px;" name="StatusFlag" id="StatusFlag">
                                                                    <option value="1" selected="selected">Active</option>
                                                                    <option value="2">Inactive</option>
                                                                </select>
                                                            </td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                        </tr>
                                                        <tr>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="2">
                                                                <label style="" for="AttendanceFlag">Exclude in Attendance % calculation</label>
                                                                <div style="display: inline-block; margin: 0 0 -6px;">
                                                                    <input name="AttendanceFlag" id="AttendanceFlag" value="1" type="checkbox" />
                                                                </div>
                                                            </td>
                                                            <td colspan="2">
                                                                <div class="errorMessage" id="StudentLeaveTypes_is_excluded_em_" style="display:none"></div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="4"></td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="4">
                                                               
                                                            </td>
                                                        </tr>
                                                    </table>
                                                    <div class="row buttons" align="center" id="add">
                                                        <input class="formbut-n" type="submit" name="yt0" value="Create" onclick="addLeaveType();" />                                                        
                                                    </div>
                                                    <div class="row buttons" align="center" style="display:none" id="update">
                                                        <input class="formbut-n" type="submit" name="yt0" value="Update" onclick="addLeaveType();"/>
                                                    </div>                                                
                                            </div>     
                                        </div>
                                    </div>

                                    <h3>Active Leave types</h3>
                                    <div class="pdtab_Con">
                                        <table width="100%" cellpadding="0" cellspacing="0">
                                            <tr class="pdtab-h">
                                                <td>Leave Type</td>
                                                <td>Code</td>
                                                <td>Label</td>
                                                <td>Colour Code</td>
                                                <td>Is Excluded</td>
                                                <td>Action</td>                                                
                                            </tr>

                                            @foreach (var item in ViewBag.activeList)
                                            {
                                                <tr>
                                                    <td style="padding-left:10px; text-align:left;">@item.Name</td>
                                                    <td style="padding-left:10px; text-align:left;">@item.Code</td>
                                                    <td style="padding-left:10px; text-align:left;">@item.Label</td>
                                                    <td style="padding-left:10px; text-align:left;">
                                                        @item.ColorCode
                                                        <span style="width:10px; height:10px; background-color:@item.ColorCode;">&nbsp;&nbsp;&nbsp;</span>
                                                    </td>
                                                    @if (@item.AttendanceFlag == 1)
                                                    {
                                                        <td style="padding-left:10px; text-align:left;">Yes</td>
                                                    }
                                                    else
                                                    {
                                                        <td style="padding-left:10px; text-align:left;">No</td>
                                                    }
                                                    <td><a href="javascript:getStudentLeaveType(@item.StudentLeaveTypeID);" id="yt1"><span style="color:orangered">Edit</span></a>&nbsp;&nbsp;&nbsp;
                                                    <a href="javascript:deleteStudentLeaveType(@item.StudentLeaveTypeID);" id="yt1"><span style="color:orangered">Delete</span></a></td>
                                                </tr>
                                            }

                                        </table>
                                    </div> <!-- END div class="tableinnerlist" -->
                                    <br />


                                    <h3>Inactive Leave types</h3>
                                    <div class="pdtab_Con">
                                        <table width="100%" cellpadding="0" cellspacing="0">
                                            <tr class="pdtab-h">
                                                <td>Leave Type</td>
                                                <td>Code</td>
                                                <td>Label</td>
                                                <td>Colour Code</td>
                                                <td>Is Excluded</td>
                                                <td>Action</td>                                                
                                            </tr>

                                            @foreach (var item in ViewBag.inActiveList)
                                            {
                                                <tr>
                                                    <td style="padding-left:10px; text-align:left;">@item.Name</td>
                                                    <td style="padding-left:10px; text-align:left;">@item.Code</td>
                                                    <td style="padding-left:10px; text-align:left;">@item.Label</td>
                                                    <td style="padding-left:10px; text-align:left;">
                                                        @item.ColorCode
                                                        <span style="width:10px; height:10px; background-color:@item.ColorCode;">&nbsp;&nbsp;&nbsp;</span>
                                                    </td>
                                                    @if (@item.AttendanceFlag == 1)
                                                    {
                                                        <td style="padding-left:10px; text-align:left;">Yes</td>
                                                    }
                                                    else
                                                    {
                                                        <td style="padding-left:10px; text-align:left;">No</td>
                                                    }
                                                    <td><a href="javascript:getStudentLeaveType(@item.StudentLeaveTypeID);" id="yt1"><span style="color:orangered">Edit</span></a>&nbsp;&nbsp;&nbsp;
                                                    <a href="javascript:deleteStudentLeaveType(@item.StudentLeaveTypeID);" id="yt1"><span style="color:orangered">Delete</span></a></td>
                                                </tr>
                                            }
                                        </table>
                                    </div>
                                </div>

    <script type="text/javascript">

        var colorWell = document.getElementById('myColor');
        colorWell.addEventListener("click", updateFirst, false);
        colorWell.addEventListener("input", updateFirst, false);
     
        function updateFirst(event) {
            var color = event.target.value;
            $('#ColorCode').val(color);
        }

        function getStudentLeaveType(StudentLeaveTypeID) {
            $.ajax({
                type: "GET",
                url: "/Student/getStudentLeaveType",
                data: { StudentLeaveTypeID: StudentLeaveTypeID },
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {                                     
                    $("#Name").val(result.StudentLeaveType.Name);
                    $("#Code").val(result.StudentLeaveType.Code);
                    $("#Label").val(result.StudentLeaveType.Label);
                    $("#ColorCode").val(result.StudentLeaveType.ColorCode);
                    $("#myColor").val(result.StudentLeaveType.ColorCode);
                    $("#StatusFlag").val(result.StudentLeaveType.StatusFlag);
                    $("#AttendanceFlag").val(result.StudentLeaveType.AttendanceFlag);
                    if (result.StudentLeaveType.AttendanceFlag == 1)
                    {
                        $(':checkbox#AttendanceFlag').attr('value', '1');
                        $(':checkbox#AttendanceFlag').attr("checked", true);
                    }
                    else
                    {
                        $(':checkbox#AttendanceFlag').attr('value', '0');
                        $(':checkbox#AttendanceFlag').attr("checked", false);
                    }                   

                    $("#StudentLeaveTypeID").val(result.StudentLeaveType.StudentLeaveTypeID)
                    $("#update").css('display', 'block');
                    $("#add").css('display', 'none');
                },
                error: function (response) {
                    alert('eror');
                }
            });
        }

        $(':checkbox#AttendanceFlag').change(function (e) {
            if ($(this).is(':checked')) {
                $(':checkbox#AttendanceFlag').attr('value', '1');
                $(':checkbox#AttendanceFlag').attr("checked", true);
            }
            else {
                $(':checkbox#AttendanceFlag').attr('value', '0');                                
            }
        });

        function deleteStudentLeaveType(StudentLeaveTypeID) {
            if (confirm("Are you sure you want to delete this student leavetype?")) {                
                $.ajax({
                    type: "POST",
                    url: "/Student/DeleteStudentLeaveType",
                    data: '{StudentLeaveTypeID: ' + StudentLeaveTypeID + '}',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (response) {
                        location.reload(true);
                    }
                });
            }
        }

        function addLeaveType() {

            var myObject = new Object();
            myObject.Name = $("#Name").val();
            myObject.Code = $("#Code").val();
            myObject.Label = $("#Label").val();
            myObject.ColorCode = $("#ColorCode").val();
            myObject.myColor = $("#myColor").val();
            myObject.StatusFlag = $("#StatusFlag").val();
            myObject.AttendanceFlag = $("#AttendanceFlag").val();
            myObject.StudentLeaveTypeID = $("#StudentLeaveTypeID").val();

            if ($('#Name').val() == "" || $('#Name').val() == null) {
                $('#Name').css("border", "1px solid red");                
                return false;
            }
            else
                $('#Name').css("border", "1px solid blue");


            if ($('#Code').val() == "" || $('#Code').val() == null) {
                $('#Code').css("border", "1px solid red");
                return false;
            }
            else
                $('#Code').css("border", "1px solid blue");


            if ($('#Label').val() == "" || $('#Label').val() == null) {
                $('#Label').css("border", "1px solid red");
                return false;
            }
            else
                $('#Label').css("border", "1px solid blue");


            if ($('#myColor').val() == "" || $('#myColor').val() == null) {
                $('#myColor').css("border", "1px solid red");
                return false;
            }
            else
                $('#myColor').css("border", "1px solid blue");

            var d = { collection: myObject };

            $.ajax({
                url: "/Student/CreateLeaveType",
                type: 'POST',
                data: JSON.stringify(d),
                dataType: "json",
                contentType: "application/json; charset=utf-8",               
                success: function (response) {
                    if (response.Message == "")
                    {
                        $('#span').html('');
                        $('#lbl').css('display', 'none');
                        window.location.href = '/Student/AddLeaveType';
                    }                        
                    else
                    {
                        $('#span').html(response.Message);
                        $('#lbl').css('display', 'block');
                    }                    
                },
                error: function () {
                }
            });
        };

        
    </script>
